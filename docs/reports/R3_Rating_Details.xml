<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<!--
	Notes:
	
	Each report MUST have a different idString.  This is how saved reports are
	linked back to the report definition
    
-->
<beans>    

    
    <!-- 
    
    	This is an Indiana University Report.  It is to be used as an example of an
    	advanced report that uses form data.  The form that this report is based upon is
    	included in this folder
    
     -->
  <bean id="ratingDetailsDirectDBAll"
        class="org.sakaiproject.reports.model.ReportDefinition">

        <property name="idString">
            <value>ratingDetailsDirectDBAll</value>
        </property>
        <property name="usesWarehouse"><value>false</value></property>
        <property name="title">
            <value>
                Rating Details (All Evaluations)
            </value>
        </property>
        <property name="query">
           <list>
           		<value><![CDATA[
              		select concat(wp.owner, concat(':', wpd.site_id)) as owner_siteuser, r.review_content_id as review_content_artifact, sc.rootcriterion_id, sc.level_id
              		From 
              			osp_wizard_page wp
						join osp_wizard_page_def wpd on wp.wiz_page_def_id = wpd.id
						join osp_review r on  wp.id = r.parent_id
						join osp_scaffolding_cell sc on wpd.id = sc.wiz_page_def_id
						join osp_scaffolding_criteria scr on scr.elt = sc.rootcriterion_id
						join osp_scaffolding_levels slv on slv.elt = sc.level_id
					where r.review_type = '1'
						and sc.scaffolding_id = ?
						and 'dummyplaceholder' != ?
					order by wp.owner, sc.scaffolding_id, scr.seq_num, slv.seq_num
					]]>
              </value>
              <value><![CDATA[
					select mlcr.description as rowName, count(mlcr.description) as numCols
					from osp_scaffolding s
						join osp_scaffolding_criteria scr on scr.scaffolding_id = s.id
						join osp_scaffolding_levels slv on slv.scaffolding_id = s.id
						join osp_matrix_label mlcr on scr.elt = mlcr.id
						join osp_matrix_label mllv on slv.elt = mllv.id
					where s.id = ?
						and 'dummyplaceholder' != ?
					group by mlcr.description, scr.seq_num
					order by scr.seq_num
              ]]>
              </value>
           		<value><![CDATA[
           			select s.title, mlcr.id as row_id, mlcr.description as rowName, mllv.id as colId, mllv.description as colName 
					from osp_scaffolding s
						join osp_scaffolding_criteria scr on scr.scaffolding_id = s.id
						join osp_scaffolding_levels slv on slv.scaffolding_id = s.id
						join osp_matrix_label mlcr on scr.elt = mlcr.id
						join osp_matrix_label mllv on slv.elt = mllv.id
					where s.id = ?
						and 'dummyplaceholder' != ?
					order by s.id, scr.seq_num, slv.seq_num
           		]]>
           		</value>
           		<value><![CDATA[
           			select distinct wp.owner
					from osp_wizard_page wp
						join osp_wizard_page_def wpd on wp.wiz_page_def_id = wpd.id
						join osp_scaffolding_cell sc on wpd.id = sc.wiz_page_def_id
					where sc.scaffolding_id = ?
						and 'dummyplaceholder' != ?
					order by wp.owner
           		]]>
           		</value>
           </list>
        </property>
        <property name="resultProcessors">
           <list>
              <ref bean="org.sakaiproject.reports.service.ResultProcessor.resourceIdArtifactLoader" />
              <ref bean="org.sakaiproject.reports.service.ResultProcessor.defaultArtifactLoader" />
              <ref bean="org.sakaiproject.reports.service.ResultProcessor.defaultSiteUserLoader" />
           </list>
        </property>
        <property name="keywords">
            <value>resources</value>
        </property>
        <property name="description">
            <value><![CDATA[
                For each cell in the matrix, gives evaluation form ratings for each participant.  If a participant has received more than one 
evaluation in one or more cells, report gives all ratings, one per row.  Answers questions for administrators, faculty, and advisors like: 
 Which students are doing especially well or especially poorly in outcome X? 
 In which students’ matrices can I find examples of poor/adequate/exemplary work for outcome X? 
 What are student A’s strengths and weakness? 
 Has student A’s skill in outcome X improved over time? 
 ]]>
            </value>
        </property>
        <property name="siteType">
            <value>portfolioAdmin,portfolio</value>
        </property>
        <property name="defaultXsl">
                <ref bean="standard"/>
        </property>

        <property name="reportDefinitionParams">
            <list>
                <bean class="org.sakaiproject.reports.model.ReportDefinitionParam">
                    <property name="title"><value>Choose a Matrix</value></property>
                    <property name="paramName"><value>matrixId</value></property>
                    <property name="description"><value>To choose a matrix</value></property>
                    <property name="type"><value>string</value></property>
                    <property name="valueType"><value>sql</value></property>
                    <property name="value"><value>SELECT id, title FROM osp_scaffolding WHERE worksiteId = '{worksiteid}' AND publishedBy IS NOT NULL</value></property>
                </bean>
                <bean class="org.sakaiproject.reports.model.ReportDefinitionParam">
                    <property name="title"><value>Most recent evaluations only?</value></property>
                    <property name="paramName"><value>mostRecentOnly</value></property>
                    <property name="description"><value>Show only the most recent evaluations when there are multiple in a participant's cell </value></property>
                    <property name="type"><value>string</value></property>
                    <property name="valueType"><value>static</value></property>
                    <property name="value"><value>false</value></property>
                </bean>
            </list>
        </property>
        <property name="xsls">
            <list>
                <ref bean="passthrough"/>
                <ref bean="standard"/>
                <ref bean="defaultExport2"/>
            </list>
        </property>

    </bean>
    
    <bean id="passthrough" class="org.sakaiproject.reports.model.ReportXsl">
                    <property name="xslLink"><value>/group/PortfolioAdmin/system/Passthrough.xsl</value></property>
                    <property name="isExport"><value>false</value></property>
                    <property name="title"><value>Passthrough</value></property>
                </bean>
                <bean id="standard" class="org.sakaiproject.reports.model.ReportXsl">
                    <property name="xslLink"><value>/group/PortfolioAdmin/R3R4_Rating_Details.xslt</value></property>
                    <property name="isExport"><value>false</value></property>
                    <property name="title"><value>Standard</value></property>
                </bean>
                <bean id="defaultExport2" class="org.sakaiproject.reports.model.ReportXsl">
                    <property name="title"><value>CSV</value></property>
                    <property name="xslLink"><value>/group/PortfolioAdmin/R3R4_Rating_Details.xslt</value></property>
                    <property name="isExport"><value>true</value></property>
                    <property name="extension"><value>csv</value></property>
                    <property name="target"><value>_self</value></property>
                    <property name="contentType"><value>application/x-csv</value></property>
                    <property name="resultsPostProcessor">
                        <ref bean="org.sakaiproject.reports.service.ResultsPostProcessor.csvAdvanced"/>
                    </property>
                </bean>

</beans>
