<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans default-lazy-init="false">


   <bean id="org.sakaiproject.springframework.orm.hibernate.AdditionalHibernateMappings.ospWizard"
      class="org.sakaiproject.springframework.orm.hibernate.impl.AdditionalHibernateMappingsImpl">
      <property name="mappingResources">
         <list>
            <value>org/theospi/portfolio/wizard/model/impl/WizardImpl.hbm.xml</value>
         </list>
      </property>
   </bean>

   <bean id="wizardToolPermissionsMap"
      class="org.theospi.portfolio.security.mgt.impl.AddPermissionTool"
      init-method="init" lazy-init="false" singleton="true" >
      <property name="manager">
         <ref bean="org.theospi.portfolio.security.mgt.PermissionManager"/>
      </property>
      <property name="additionalTools">
         <map>
            <entry key="wizard">
               <ref bean="org.theospi.portfolio.security.mgt.ToolPermissionManager.wizard"/>
            </entry>
         </map>
      </property>
   </bean>
   
   <bean id="org.theospi.portfolio.security.mgt.ToolPermissionManager.wizard"
      class="org.theospi.portfolio.security.model.SimpleToolPermissionManager"
       singleton="true">

      <property name="idManager"><ref bean="idManager"/></property>
      <property name="permissionManager">
         <ref bean="org.theospi.portfolio.security.mgt.PermissionManager" />
      </property>
      <property name="agentManager"><ref bean="agentManager" /></property>
      <property name="permissionEditName"><value>wizard</value></property>
      <property name="defaultPermissions">
         <map>
            <entry key="maintain">
               <list>
                  <value>osp.wizard.publish</value>
                  <value>osp.wizard.delete</value>
                  <value>osp.wizard.create</value>
                  <value>osp.wizard.edit</value>
                  <value>osp.wizard.review</value>
                  <value>osp.wizard.evaluate</value>
                  <value>osp.wizard.view</value>
                  <value>osp.wizard.copy</value>
                  <value>osp.wizard.export</value>
               </list>
            </entry>
            <entry key="access">
               <list>
                  <value>osp.wizard.create</value>
                  <value>osp.wizard.view</value>
               </list>
            </entry>
         </map>
      </property>
      <property name="functions">
         <list>
            <value>osp.wizard.publish</value>
            <value>osp.wizard.delete</value>
            <value>osp.wizard.create</value>
            <value>osp.wizard.edit</value>
            <value>osp.wizard.review</value>
            <value>osp.wizard.evaluate</value>
            <value>osp.wizard.view</value>
            <value>osp.wizard.copy</value>
            <value>osp.wizard.export</value>
         </list>
      </property>
   </bean>
   
   <bean id="org.theospi.portfolio.security.app.AdditionalAppAuthorizers.wizard"
      class="org.theospi.portfolio.security.app.AdditionalAppAuthorizers"
      init-method="init" singleton="true">
      <property name="authzManager"><ref bean="authzManager"/></property>
      <property name="additionalAppAuthorizers">
         <list>
            <bean class="org.theospi.portfolio.security.app.OrderedAuthorizer">
               <property name="order"><value>4</value></property>
               <property name="authorizer"><ref bean="wizardAuthz"/></property>
            </bean>
         </list>
      </property>
   </bean>

   <bean id="wizardAuthz" class="org.theospi.portfolio.wizard.WizardAuthorizerImpl">
      <property name="wizardManager"><ref bean="org.theospi.portfolio.wizard.mgt.WizardManager"/></property>
      <property name="idManager"><ref bean="idManager"/></property>
      <property name="functions">
         <list>            
            <bean id="org.theospi.portfolio.wizard.WizardFunctionConstants.CREATE_WIZARD"
               class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
            </bean>
            <bean id="org.theospi.portfolio.wizard.WizardFunctionConstants.EDIT_WIZARD"
               class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
            </bean>
            <bean id="org.theospi.portfolio.wizard.WizardFunctionConstants.DELETE_WIZARD"
               class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
            </bean>
            <bean id="org.theospi.portfolio.wizard.WizardFunctionConstants.PUBLISH_WIZARD"
               class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
            </bean>
            <bean id="org.theospi.portfolio.wizard.WizardFunctionConstants.REVIEW_WIZARD"
               class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
            </bean>
            <bean id="org.theospi.portfolio.wizard.WizardFunctionConstants.EVALUATE_WIZARD"
               class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
            </bean>
            <bean id="org.theospi.portfolio.wizard.WizardFunctionConstants.VIEW_WIZARD"
               class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
            </bean>
            <bean id="org.theospi.portfolio.wizard.WizardFunctionConstants.COPY_WIZARD"
               class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
            </bean>
            <bean id="org.theospi.portfolio.wizard.WizardFunctionConstants.EXPORT_WIZARD"
               class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
            </bean>
         </list>
      </property>
   </bean>

   <bean id="org.sakaiproject.service.legacy.entity.HttpAccess.ospWizard"
      class="org.theospi.portfolio.wizard.impl.WizardHttpAccess">
      <property name="idManager">
         <ref bean="idManager"/>
      </property>
      <property name="wizardManager">
         <ref bean="org.theospi.portfolio.wizard.mgt.WizardManager"/>
      </property>
      <property name="authzManager"><ref bean="authzManager"/></property>
   </bean>

   <bean id="org.sakaiproject.service.legacy.entity.EntityProducer.ospWizard"
      class="org.theospi.portfolio.wizard.impl.WizardEntityProducer"
      init-method="init"
      destroy-method="destroy"
      singleton="true">
      <property name="entityManager">
         <ref bean="org.sakaiproject.service.legacy.entity.EntityManager"/>
      </property>
      <property name="httpAccess">
         <ref bean="org.sakaiproject.service.legacy.entity.HttpAccess.ospWizard" />
      </property>
   </bean>

   <bean id="org.theospi.portfolio.wizard.mgt.WizardManager.target"
      class="org.theospi.portfolio.wizard.mgt.impl.WizardManagerImpl"
      singleton="true" init-method="init" >
      <property name="sessionFactory">
         <ref bean="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory"/>
      </property>
      <property name="guidanceManager">
         <ref bean="org.theospi.portfolio.guidance.mgt.GuidanceManager"/> 
      </property>
      <property name="authorizationFacade">
         <ref bean="authzManager"/>
      </property>
      <property name="authManager"><ref bean="authManager"/></property>
      <property name="securityService">
         <ref bean="org.sakaiproject.service.legacy.security.SecurityService"/>
      </property>
      <property name="idManager"><ref bean="idManager"/></property>
      <property name="entityManager">
         <ref bean="org.sakaiproject.service.legacy.entity.EntityManager"/>
      </property>
      <property name="agentManager"><ref bean="agentManager"/></property>
      <property name="structuredArtifactDefinitionManager"><ref bean="structuredArtifactDefinitionManager"/></property>
      <property name="workflowManager">
         <ref bean="org.theospi.portfolio.workflow.mgt.WorkflowManager"/>
      </property>
   </bean>

   <bean id="org.theospi.portfolio.wizard.mgt.WizardManager"
      class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
      singleton="true">
      <property name="transactionManager">
        <ref bean="org.sakaiproject.springframework.orm.hibernate.GlobalTransactionManager"/>
      </property>
      <property name="target">
         <ref bean="org.theospi.portfolio.wizard.mgt.WizardManager.target"/>
      </property>
      <property name="transactionAttributes">
         <props>
            <prop key="*">PROPAGATION_REQUIRED</prop>
         </props>
      </property>
   </bean>

   <bean id="org.sakaiproject.service.legacy.content.ContentResourceFilter.wizardStyleFile"
      parent="org.sakaiproject.service.legacy.content.ContentResourceFilter.base">
      <property name="viewAll"><value>true</value></property>
      <property name="mimeTypes">
         <list>
            <value>text/css</value>
         </list>
      </property>
      <property name="acceptedExtensions">
         <list>
            <value>css</value>
         </list>
      </property>
   </bean>
</beans>