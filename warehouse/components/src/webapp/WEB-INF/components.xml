<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans default-lazy-init="false">

   <!-- The "slow" connection pool for streaming downloads from db -->
   <bean id="org.theospi.portfolio.warehouse.intf.DataWarehouseManager.dataSource"
     parent="javax.sql.BaseDataSource">
   </bean>

   <bean id="org.theospi.portfolio.warehouse.intf.DataWarehouseManager"
      class="org.theospi.portfolio.warehouse.impl.DataWarehouseManagerImpl">
      <property name="tasks">
         <list>
         </list>
      </property>
   </bean>

   <!-- commonly used fields -->
   <bean id="org.theospi.portfolio.warehouse.intf.PropertyAccess.id"
      class="org.theospi.portfolio.warehouse.impl.IdPropertyAccess">
      <property name="propertyName"><value>id</value></property>
   </bean>

   <bean id="org.theospi.portfolio.warehouse.intf.PropertyAccess.parentId"
      class="org.theospi.portfolio.warehouse.impl.BaseParentPropertyAccess">
      <property name="base">
         <ref bean="org.theospi.portfolio.warehouse.intf.PropertyAccess.id" />
      </property>
   </bean>

   <bean id="org.theospi.portfolio.warehouse.intf.PropertyAccess.owner"
      class="org.theospi.portfolio.warehouse.impl.AgentPropertyAccess">
      <property name="propertyName"><value>owner</value></property>
   </bean>
   <!-- /commonly used fields -->

   <bean id="org.theospi.portfolio.warehouse.intf.WarehouseTask.presentation"
      class="org.theospi.portfolio.warehouse.osp.PresentationWarehouseTask"
      init-method="init" singleton="true">
      <property name="dataSource">
         <ref bean="org.theospi.portfolio.warehouse.intf.DataWarehouseManager.dataSource" />
      </property>
      <property name="dataWarehouseManager">
         <ref bean="org.theospi.portfolio.warehouse.intf.DataWarehouseManager" />
      </property>
      <property name="tableDdlResource">
         <value>/org/theospi/portfolio/warehouse/osp/presentation.xml</value>
      </property>
      <property name="presentationManager">
         <ref bean="presentationManager" />
      </property>
      <property name="task">
         <ref bean="org.theospi.portfolio.warehouse.intf.ChildWarehouseTask.presentation"/>
      </property>
   </bean>

   <bean id="org.theospi.portfolio.warehouse.intf.ChildWarehouseTask.presentation"
      class="org.theospi.portfolio.warehouse.impl.BaseChildWarehouseTask">
      <property name="fields">
         <list>
            <ref bean="org.theospi.portfolio.warehouse.intf.PropertyAccess.id" />
            <ref bean="org.theospi.portfolio.warehouse.intf.PropertyAccess.owner" />
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>name</value></property>
            </bean>
         </list>
      </property>
      <property name="insertStmt">
         <value>insert into DW_PRESENTATION (id, owner, name) values (?, ?, ?)</value>
      </property>
      <property name="clearStmt">
         <value>delete from DW_PRESENTATION</value>
      </property>
      <property name="complexFields" >
         <list>
            <bean class="org.theospi.portfolio.warehouse.impl.ChildFieldWrapper">
               <property name="propertyAccess">
                  <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
                     <property name="propertyName"><value>items</value></property>
                  </bean>
               </property>
               <property name="task">
                  <ref bean="org.theospi.portfolio.warehouse.intf.ChildWarehouseTask.presentation.item"/>
               </property>
            </bean>
         </list>
      </property>
   </bean>

   <bean id="org.theospi.portfolio.warehouse.intf.ChildWarehouseTask.presentation.item"
      class="org.theospi.portfolio.warehouse.impl.BaseChildWarehouseTask">
      <property name="fields">
         <list>
            <ref bean="org.theospi.portfolio.warehouse.intf.PropertyAccess.parentId" />
            <bean class="org.theospi.portfolio.warehouse.impl.IdPropertyAccess">
               <property name="propertyName"><value>artifactId</value></property>
            </bean>
         </list>
      </property>
      <property name="insertStmt">
         <value>insert into DW_PRES_ITEM (presentation_id, artifact) values (?, ?)</value>
      </property>
      <property name="clearStmt">
         <value>delete from DW_PRES_ITEM</value>
      </property>
   </bean>

   <bean id="org.sakaiproject.api.app.scheduler.JobBeanWrapper.ospDataWarehouse"
      class="org.sakaiproject.component.app.scheduler.jobs.SpringJobBeanWrapper"
      singleton="true" init-method="init">
      <property name="beanId">
         <value>org.theospi.portfolio.warehouse.intf.DataWarehouseManager</value>
      </property>
      <property name="jobName">
         <value>Data Warehouse Update</value>
      </property>
      <property name="schedulerManager">
         <ref bean="org.sakaiproject.api.app.scheduler.SchedulerManager" />
      </property>
   </bean>

<!--
   <bean id="ospHelpHibernateMappings"
      class="org.sakaiproject.springframework.orm.hibernate.impl.AdditionalHibernateMappingsImpl">
      <property name="mappingResources">
         <list>
            <value>org/theospi/portfolio/help/model/impl/HelpImpl.hbm.xml</value>
         </list>
		</property>
   </bean>

   <bean id="helpManagerTarget" class="org.theospi.portfolio.help.HelpManagerImpl">
      <property name="sessionFactory">
         <ref bean="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory"/>
      </property>
      <property name="idManager"><ref bean="idManager"/></property>
      <property name="worksiteManager">
         <ref bean="org.sakaiproject.metaobj.worksite.mgt.WorksiteManager"/>
      </property>
      <property name="toolManager">
         <ref bean="org.sakaiproject.api.kernel.tool.ToolManager"/>
      </property>
      <property name="portalService">
         <ref bean="org.sakaiproject.service.framework.portal.PortalService"/>
      </property>
      <property name="authzManager"><ref bean="authzManager"/></property>
      <property name="glossary"><ref bean="glossary"/></property>
   </bean>

   <bean id="glossaryTarget" class="org.theospi.portfolio.help.model.DbGlossary"
      init-method="init" lazy-init="false">
      <property name="sessionFactory">
         <ref bean="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory"/>
      </property>
      <property name="idManager"><ref bean="idManager"/></property>
      <property name="url"><value>${serverUrl}/osp-glossary-tool/glossary.osp</value></property>
   </bean>

   <bean id="helpManager"
      class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
      singleton="true">
      <property name="transactionManager">
        <ref bean="org.sakaiproject.springframework.orm.hibernate.GlobalTransactionManager"/>
      </property>
      <property name="target">
         <ref bean="helpManagerTarget"/>
      </property>
      <property name="transactionAttributes">
         <props>
            <prop key="*">PROPAGATION_REQUIRED</prop>
         </props>
      </property>
   </bean>

   <bean id="glossary"
      class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
      singleton="true">
      <property name="transactionManager">
        <ref bean="org.sakaiproject.springframework.orm.hibernate.GlobalTransactionManager"/>
      </property>
      <property name="target">
         <ref bean="glossaryTarget"/>
      </property>
      <property name="transactionAttributes">
         <props>
            <prop key="*">PROPAGATION_REQUIRED</prop>
         </props>
      </property>
   </bean>

   <bean id="org.theospi.portfolio.security.mgt.ToolPermissionManager.glossary"
      class="org.theospi.portfolio.security.model.SimpleToolPermissionManager" >
      <property name="idManager"><ref bean="idManager"/></property>
      <property name="permissionManager">
         <ref bean="org.theospi.portfolio.security.mgt.PermissionManager" />
      </property>
      <property name="agentManager"><ref bean="agentManager" /></property>
      <property name="permissionEditName"><value>glossary</value></property>
      <property name="defaultPermissions">
         <map>
            <entry key="maintain">
               <list>
                  <value>osp.help.glossary.delete</value>
                  <value>osp.help.glossary.add</value>
                  <value>osp.help.glossary.edit</value>
               </list>
            </entry>
            <entry key="instructor">
               <list>
                  <value>osp.help.glossary.delete</value>
                  <value>osp.help.glossary.add</value>
                  <value>osp.help.glossary.edit</value>
               </list>
            </entry>
            <entry key="project owner">
               <list>
                  <value>osp.help.glossary.delete</value>
                  <value>osp.help.glossary.add</value>
                  <value>osp.help.glossary.edit</value>
               </list>
            </entry>
         </map>
      </property>
      <property name="functions">
         <list>
            <value>osp.help.glossary.delete</value>
            <value>osp.help.glossary.add</value>
            <value>osp.help.glossary.edit</value>
         </list>
      </property>
   </bean>

   <bean id="org.theospi.portfolio.security.mgt.ToolPermissionManager.glossaryGlobal"
      class="org.theospi.portfolio.security.model.QualifiedSimpleToolPermissionManager" >
      <property name="idManager"><ref bean="idManager"/></property>
      <property name="qualifier"><value>theospi.help.glossary.global</value></property>
      <property name="permissionManager">
         <ref bean="org.theospi.portfolio.security.mgt.PermissionManager" />
      </property>
      <property name="agentManager"><ref bean="agentManager" /></property>
      <property name="permissionEditName"><value>glossary</value></property>
      <property name="defaultPermissions">
         <map>
            <entry key="maintain">
               <list>
                  <value>osp.help.glossary.delete</value>
                  <value>osp.help.glossary.add</value>
                  <value>osp.help.glossary.edit</value>
               </list>
            </entry>
            <entry key="instructor">
               <list>
                  <value>osp.help.glossary.delete</value>
                  <value>osp.help.glossary.add</value>
                  <value>osp.help.glossary.edit</value>
               </list>
            </entry>
            <entry key="project owner">
               <list>
                  <value>osp.help.glossary.delete</value>
                  <value>osp.help.glossary.add</value>
                  <value>osp.help.glossary.edit</value>
               </list>
            </entry>
         </map>
      </property>
      <property name="functions">
         <list>
            <value>osp.help.glossary.delete</value>
            <value>osp.help.glossary.add</value>
            <value>osp.help.glossary.edit</value>
         </list>
      </property>
   </bean>

   <bean id="glosasryToolPermissionsMap"
      class="org.theospi.portfolio.security.mgt.impl.AddPermissionTool"
      init-method="init" lazy-init="false"  >
      <property name="manager">
         <ref bean="org.theospi.portfolio.security.mgt.PermissionManager"/>
      </property>
      <property name="additionalTools">
         <map>
            <entry key="glossary">
               <ref bean="org.theospi.portfolio.security.mgt.ToolPermissionManager.glossary"/>
            </entry>
         </map>
      </property>
   </bean>
   -->

</beans>
