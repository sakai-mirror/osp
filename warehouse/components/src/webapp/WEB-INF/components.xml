<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans default-lazy-init="false">

   <!-- The "slow" connection pool for streaming downloads from db -->
   <bean id="org.theospi.portfolio.warehouse.intf.DataWarehouseManager.dataSource"
     parent="javax.sql.BaseDataSource">
   </bean>

   <bean id="org.theospi.portfolio.warehouse.intf.DataWarehouseManager"
      class="org.theospi.portfolio.warehouse.impl.DataWarehouseManagerImpl">
      <property name="tasks">
         <list>
         </list>
      </property>
      <property name="securityService">
         <ref bean="org.sakaiproject.service.legacy.security.SecurityService"/>
      </property>
   </bean>

   <!-- commonly used fields -->
   <bean id="org.theospi.portfolio.warehouse.intf.PropertyAccess.id"
      class="org.theospi.portfolio.warehouse.impl.IdPropertyAccess">
      <property name="propertyName"><value>id</value></property>
   </bean>

   <bean id="org.theospi.portfolio.warehouse.intf.PropertyAccess.parentId"
      class="org.theospi.portfolio.warehouse.impl.BaseParentPropertyAccess">
      <property name="base">
         <ref bean="org.theospi.portfolio.warehouse.intf.PropertyAccess.id" />
      </property>
   </bean>

   <bean id="org.theospi.portfolio.warehouse.intf.PropertyAccess.owner"
      class="org.theospi.portfolio.warehouse.impl.AgentPropertyAccess">
      <property name="propertyName"><value>owner</value></property>
   </bean>
   <!-- /commonly used fields -->

   <bean id="org.theospi.portfolio.warehouse.intf.WarehouseTask.presentation"
      class="org.theospi.portfolio.warehouse.osp.presentation.PresentationWarehouseTask"
      init-method="init" singleton="true">
      <property name="dataSource">
         <ref bean="org.theospi.portfolio.warehouse.intf.DataWarehouseManager.dataSource" />
      </property>
      <property name="dataWarehouseManager">
         <ref bean="org.theospi.portfolio.warehouse.intf.DataWarehouseManager" />
      </property>
      <property name="tableDdlResource">
         <value>/org/theospi/portfolio/warehouse/osp/presentation.xml</value>
      </property>
      <property name="presentationManager">
         <ref bean="presentationManager" />
      </property>
      <property name="task">
         <ref bean="org.theospi.portfolio.warehouse.intf.ChildWarehouseTask.presentation"/>
      </property>
   </bean>

   <!-- presentation stuff -->
   <bean id="org.theospi.portfolio.warehouse.intf.ChildWarehouseTask.presentation"
      class="org.theospi.portfolio.warehouse.impl.BaseChildWarehouseTask">
      <property name="fields">
         <list>
            <ref bean="org.theospi.portfolio.warehouse.intf.PropertyAccess.id" />
            <ref bean="org.theospi.portfolio.warehouse.intf.PropertyAccess.owner" />
            <bean class="org.theospi.portfolio.warehouse.impl.IdentifiableObjectPropertyAccess">
               <property name="propertyName"><value>template</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>name</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>description</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>isDefault</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>isPublic</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>expiresOn</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>created</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>modified</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>toolId</value></property>
            </bean>
         </list>
      </property>
      <property name="insertStmt">
         <value>insert into DW_PRESENTATION
                  (id, owner_id, template_id, name, description, isDefault,
                  isPublic, expiresOn, created, modified, tool_id)
               values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)</value>
      </property>
      <property name="clearStmt">
         <value>delete from DW_PRESENTATION</value>
      </property>
      <property name="complexFields" >
         <list>
            <bean class="org.theospi.portfolio.warehouse.impl.ChildFieldWrapper">
               <property name="propertyAccess">
                  <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
                     <property name="propertyName"><value>items</value></property>
                  </bean>
               </property>
               <property name="task">
                  <ref bean="org.theospi.portfolio.warehouse.intf.ChildWarehouseTask.presentation.item"/>
               </property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.ChildFieldWrapper">
               <property name="propertyAccess">
                  <bean class="org.theospi.portfolio.warehouse.osp.presentation.PresentationCommentsPropertyAccess">
                     <property name="presentationManager">
                        <ref bean="presentationManager" />
                     </property>
                  </bean>
               </property>
               <property name="task">
                  <ref bean="org.theospi.portfolio.warehouse.intf.ChildWarehouseTask.presentation.comment"/>
               </property>
            </bean>
         </list>
      </property>
   </bean>

   <bean id="org.theospi.portfolio.warehouse.intf.ChildWarehouseTask.presentation.item"
      class="org.theospi.portfolio.warehouse.impl.BaseChildWarehouseTask">
      <property name="fields">
         <list>
            <ref bean="org.theospi.portfolio.warehouse.intf.PropertyAccess.parentId" />
            <bean class="org.theospi.portfolio.warehouse.impl.IdPropertyAccess">
               <property name="propertyName"><value>artifactId</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.IdentifiableObjectPropertyAccess">
               <property name="propertyName"><value>definition</value></property>
            </bean>
         </list>
      </property>
      <property name="insertStmt">
         <value>insert into DW_PRESENTATION_ITEM (presentation_id, artifact_id, item_definition_id) values (?, ?, ?)</value>
      </property>
      <property name="clearStmt">
         <value>delete from DW_PRESENTATION_ITEM</value>
      </property>
   </bean>

   <bean id="org.theospi.portfolio.warehouse.intf.ChildWarehouseTask.presentation.comment"
      class="org.theospi.portfolio.warehouse.impl.BaseChildWarehouseTask">
      <property name="fields">
         <list>
            <ref bean="org.theospi.portfolio.warehouse.intf.PropertyAccess.id" />
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>title</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.AgentPropertyAccess">
               <property name="propertyName"><value>creator</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.IdentifiableObjectPropertyAccess">
               <property name="propertyName"><value>presentation</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>visibility</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>created</value></property>
            </bean>
         </list>
      </property>
      <property name="insertStmt">
         <value>insert into DW_PRESENTATION_COMMENT (id, title, creator_id, presentation_id, visibility, created)
                                             values (?, ?, ?, ?, ?, ?)
         </value>
      </property>
      <property name="clearStmt">
         <value>delete from DW_PRESENTATION_COMMENT</value>
      </property>
   </bean>
   <!-- /presentation stuff -->

   <!-- content resource stuff -->
   <bean id="org.theospi.portfolio.warehouse.intf.WarehouseTask.contentResources"
      class="org.theospi.portfolio.warehouse.sakai.resource.ContentResourceWarehouseTask"
      init-method="init" singleton="true">
      <property name="dataSource">
         <ref bean="org.theospi.portfolio.warehouse.intf.DataWarehouseManager.dataSource" />
      </property>
      <property name="dataWarehouseManager">
         <ref bean="org.theospi.portfolio.warehouse.intf.DataWarehouseManager" />
      </property>
      <property name="tableDdlResource">
         <value>/org/theospi/portfolio/warehouse/sakai/resource.xml</value>
      </property>
      <property name="contentHostingService">
         <ref bean="org.sakaiproject.service.legacy.content.ContentHostingService" />
      </property>
      <property name="task">
         <ref bean="org.theospi.portfolio.warehouse.intf.ChildWarehouseTask.contentResources"/>
      </property>
   </bean>

   <bean id="org.theospi.portfolio.warehouse.intf.ChildWarehouseTask.contentResources"
      class="org.theospi.portfolio.warehouse.impl.BaseChildWarehouseTask">
      <property name="fields">
         <list>
            <bean class="org.theospi.portfolio.warehouse.sakai.resource.ResourceUuidPropertyAccess"/>
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>id</value></property>
            </bean>
            <bean class="org.theospi.portfolio.warehouse.impl.BeanPropertyAccess">
               <property name="propertyName"><value>contentType</value></property>
            </bean>
         </list>
      </property>
      <property name="insertStmt">
         <value>insert into DW_RESOURCE
                  (id, uri, resource_type)
               values (?, ?, ?)</value>
      </property>
      <property name="clearStmt">
         <value>delete from DW_RESOURCE</value>
      </property>
   </bean>
   <!-- /content resource stuff -->

   <bean id="org.sakaiproject.api.app.scheduler.JobBeanWrapper.ospDataWarehouse"
      class="org.sakaiproject.component.app.scheduler.jobs.SpringJobBeanWrapper"
      singleton="true" init-method="init">
      <property name="beanId">
         <value>org.theospi.portfolio.warehouse.intf.DataWarehouseManager</value>
      </property>
      <property name="jobName">
         <value>Data Warehouse Update</value>
      </property>
      <property name="schedulerManager">
         <ref bean="org.sakaiproject.api.app.scheduler.SchedulerManager" />
      </property>
   </bean>

</beans>
