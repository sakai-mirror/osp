<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

    <bean id="org.theospi.tool.reports.ReportsHibernateBean"
        class="org.sakaiproject.springframework.orm.hibernate.impl.AdditionalHibernateMappingsImpl">
        <property name="mappingResources">
            <list>
                <value>
                    org/theospi/portfolio/reports/model/impl/ReportsImpl.hbm.xml
                </value>
            </list>
        </property>
    </bean>

    <bean id="org.theospi.portfolio.reports.model.ReportsManager"
        class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
        <property name="transactionManager">
            <ref bean="org.sakaiproject.springframework.orm.hibernate.GlobalTransactionManager" />
        </property>
        <property name="target">
            <bean
                class="org.theospi.portfolio.reports.model.impl.ReportsManagerImpl"
                singleton="true" init-method="init">

                <property name="sessionFactory">
                    <ref
                        bean="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory" />
                </property>
               <property name="securityService">
                  <ref bean="org.sakaiproject.authz.api.SecurityService"/>
               </property>
               <property name="idManager">
                   <ref bean="idManager" />
               </property>
                 <property name="contentHosting">
                   <ref bean="org.sakaiproject.content.api.ContentHostingService"/>
                </property>
               <property name="authzManager">
                  <ref bean="org.sakaiproject.metaobj.security.AuthorizationFacade"/>
               </property>
                <property name="ospAuthzManager">
                  <ref bean="authzManager"/>
               </property>
               <property name="authnManager"><ref bean="authManager"/></property>
               <!-- leave the dataSource blank and it will automatically default to the Data warehouse data source. -->
               <!-- by filling in the dataSource it will use that for the alternative dataSource. -->
               <!-- if the datawarehouse isn't being deployed, then either this needs to be filled in or
               			if the dataSource is null thus defaulting to the DW datasource which isn't there
               			which then the code will default to the sakai data source -->
               <!--
                <property name="dataSource">
   			        <ref bean="org.theospi.portfolio.warehouse.intf.DataWarehouseManager.dataSource" />
                </property>
                -->
                <property name="sakaiDataSource">
   			        <ref bean="javax.sql.DataSource"/>
                </property>
                <property name="forceColumnLabelUppercase">
                	<value>true</value>
                	<!-- <value>false</value> -->
                </property>
                <property name="schedulerManager">
                    <ref bean="org.sakaiproject.api.app.scheduler.SchedulerManager"/>
                </property>
                <property name="jobBeanWrapper">
                    <ref bean="org.sakaiproject.api.app.scheduler.JobBeanWrapper.reports"/>
                </property>
                <property name="definedDefintions">
                    <list>
                        <bean class="org.theospi.portfolio.reports.model.impl.ReportsDefinitionWrapper">
                            <property name="idValue">
                                <value>11112222-3333-4444-5551-666697779193</value>
                            </property>
                            <property name="beanId">
                                <value>matrixPendingDirectDB1</value>
                            </property>
                            <property name="definitionFileLocation">
                                <value>/org/theospi/portfolio/reports/definition/matrix-report-1.xml</value>
                            </property>
                         </bean>
                        <bean class="org.theospi.portfolio.reports.model.impl.ReportsDefinitionWrapper">
                            <property name="idValue">
                                <value>11112222-3333-4444-5551-666697788192</value>
                            </property>
                            <property name="beanId">
                                <value>matrixAttachmentsDirectDB</value>
                            </property>
                            <property name="definitionFileLocation">
                                <value>/org/theospi/portfolio/reports/definition/matrix-report-2.xml</value>
                            </property>
                         </bean>
                    </list>
                </property>
            </bean>
        </property>
        <property name="transactionAttributes">
            <props>
                <prop key="*">PROPAGATION_REQUIRED</prop>
            </props>
        </property>
    </bean>

   <bean id="org.sakaiproject.metaobj.shared.ArtifactFinder.fileArtifactReports"
      parent="org.sakaiproject.metaobj.shared.ArtifactFinder.fileArtifact"
      class="org.theospi.portfolio.shared.mgt.ContentWrappedArtifactFinder" />

   <bean id="org.sakaiproject.metaobj.shared.ArtifactFinderManager.reports"
      class="org.theospi.portfolio.shared.mgt.WrappedArtifactFinderManager">
      <property name="base">
         <ref bean="artifactFinderManager"/>
      </property>
      <property name="substitutions">
         <map>
            <entry key="fileArtifact">
               <ref bean="org.sakaiproject.metaobj.shared.ArtifactFinder.fileArtifactReports" />
            </entry>
         </map>
      </property>
   </bean>

   <bean id="org.theospi.portfolio.reports.model.ResultProcessor.defaultArtifactLoader"
      class="org.theospi.portfolio.reports.model.impl.LoadArtifactResultProcessor">
      <property name="idManager"><ref bean="idManager"/></property>
      <property name="artifactFinderManager">
         <ref bean="org.sakaiproject.metaobj.shared.ArtifactFinderManager.reports" />
      </property>
      <property name="securityService">
         <ref bean="org.sakaiproject.authz.api.SecurityService"/>
      </property>
      <property name="reportsManager">
         <ref bean="org.theospi.portfolio.reports.model.ReportsManager"/>
      </property>
      <property name="columnNamePattern">
      	<value>.*_(artifact|ARTIFACT)$</value>
      </property>
   </bean>

   <bean id="org.theospi.portfolio.reports.model.ResultProcessor.defaultDisplayNameLoader"
      class="org.theospi.portfolio.reports.model.impl.LoadDisplayNamesProcessor">
      <property name="securityService">
         <ref bean="org.sakaiproject.authz.api.SecurityService"/>
      </property>
      <property name="columnNamePattern">
      	<value>.*_(displayname|DISPLAYNAME)$</value>
      </property>
   </bean>

   <bean id="org.sakaiproject.entity.api.HttpAccess.ospReports"
      class="org.theospi.portfolio.reports.model.impl.ReportsHttpAccess">
      <property name="reportsManager">
         <ref bean="org.theospi.portfolio.reports.model.ReportsManager"/>
      </property>
      <property name="authzManager"><ref bean="authzManager"/></property>
   </bean>

   <bean id="org.sakaiproject.entity.api.EntityProducer.ospReports"
      class="org.theospi.portfolio.reports.model.impl.ReportsEntityProducer"
      init-method="init"
		destroy-method="destroy"
		singleton="true">
      <property name="entityManager">
         <ref bean="org.sakaiproject.entity.api.EntityManager"/>
      </property>
      <property name="httpAccess">
         <ref bean="org.sakaiproject.entity.api.HttpAccess.ospReports" />
      </property>
   </bean>

   <bean id="org.theospi.portfolio.reports.model.ResultsPostProcessor.csv"
      class="org.theospi.portfolio.reports.model.impl.CsvResultPostProcessor" />

              <bean id="org.theospi.portfolio.reports.model.ResultsPostProcessor.rowcolumn"
                 class="org.theospi.portfolio.reports.model.impl.GroupingResultProcessor">
                    <property name="grouping">
                       <list>
                          <value>criterion_sequence</value>
                          <value>level_sequence</value>
                          <value>userId</value>
                       </list>
                    </property>
              </bean>
              <bean id="org.theospi.portfolio.reports.model.ResultsPostProcessor.rowcolumneval"
                 class="org.theospi.portfolio.reports.model.impl.GroupingResultProcessor">
                    <property name="grouping">
                       <list>
                          <value>criterion_sequence</value>
                          <value>level_sequence</value>
                          <value>userId</value>
                          <value>evaluators</value>
                       </list>
                    </property>
              </bean>
              <bean id="org.theospi.portfolio.reports.model.ResultsPostProcessor.rowcolumnupper"
                 class="org.theospi.portfolio.reports.model.impl.GroupingResultProcessor">
                    <property name="grouping">
                       <list>
                          <value>CRITERION_SEQUENCE</value>
                          <value>LEVEL_SEQUENCE</value>
                          <value>USERID</value>
                       </list>
                    </property>
              </bean>
              <bean id="org.theospi.portfolio.reports.model.ResultsPostProcessor.rowcolumnevalupper"
                 class="org.theospi.portfolio.reports.model.impl.GroupingResultProcessor">
                    <property name="grouping">
                       <list>
                          <value>CRITERION_SEQUENCE</value>
                          <value>LEVEL_SEQUENCE</value>
                          <value>USERID</value>
                          <value>EVALUATORS</value>
                       </list>
                    </property>
              </bean>

   <bean id="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_CREATE"
      class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean"/>
   <bean id="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_RUN"
      class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean"/>
   <bean id="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_VIEW"
      class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean"/>
   <bean id="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_EDIT"
      class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean"/>
   <bean id="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_DELETE"
      class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean"/>

   <bean id="org.theospi.portfolio.security.model.SakaiDefaultPermsManager.reports"
      parent="org.theospi.portfolio.security.model.SakaiDefaultPermsManager.base"
      singleton="true" init-method="init">
      <property name="prefix">
         <bean id="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_PREFIX"
            class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean"/>
      </property>
      <property name="functions">
         <list>
            <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_CREATE"/>
            <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_RUN"/>
            <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_VIEW"/>
            <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_EDIT"/>
            <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_DELETE"/>
         </list>
      </property>
      <property name="defaultPermissions">
         <map>
            <entry key="!site.template">
               <map>
                  <entry key="maintain">
                     <list>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_CREATE"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_RUN"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_VIEW"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_EDIT"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_DELETE"/>
                     </list>
                  </entry>
               </map>
            </entry>
            <entry key="!site.template.portfolio">
               <map>
                  <entry key="CIG Coordinator">
                     <list>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_CREATE"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_RUN"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_VIEW"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_EDIT"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_DELETE"/>
                     </list>
                  </entry>
               </map>
            </entry>
            <entry key="!site.template.portfolioAdmin">
               <map>
                  <entry key="Program Admin">
                     <list>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_CREATE"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_RUN"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_VIEW"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_EDIT"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_DELETE"/>
                     </list>
                  </entry>
                  <entry key="Program Coordinator">
                     <list>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_CREATE"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_RUN"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_VIEW"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_EDIT"/>
                        <ref bean="org.theospi.portfolio.reports.model.ReportFunctions.REPORT_FUNCTION_DELETE"/>
                     </list>
                  </entry>
               </map>
            </entry>
         </map>
      </property>
   </bean>

     <bean id="org.sakaiproject.content.api.ContentResourceFilter.reportImportFile"
      parent="org.sakaiproject.content.api.ContentResourceFilter.base">
        <property name="viewAll">
            <value>true</value>
        </property>
      <property name="mimeTypes">
         <list>
           <value>text/xml</value>
           <value>application/xml</value>
         </list>
      </property>
      <property name="acceptedExtensions">
         <list>
            <value>xml</value>
         </list>
      </property>
   </bean>
  <bean id="org.sakaiproject.content.api.ContentResourceFilter.reportXslFile"
      parent="org.sakaiproject.content.api.ContentResourceFilter.base">
      <property name="viewAll">
         <value>true</value>
      </property>
      <property name="mimeTypes">
         <list>
            <value>text/xml</value>
         </list>
      </property>
      <property name="acceptedExtensions">
         <list>
            <value>xsl</value>
         </list>
      </property>
   </bean>

    <bean id="org.sakaiproject.api.app.scheduler.JobBeanWrapper.reports"
          class="org.sakaiproject.component.app.scheduler.jobs.SpringJobBeanWrapper"
          singleton="true">
        <property name="beanId">
            <value>org.theospi.portfolio.reports.model.ReportsManager</value>
        </property>
        <property name="jobName">
            <value>Report</value>
        </property>
        <property name="schedulerManager">
            <ref bean="org.sakaiproject.api.app.scheduler.SchedulerManager"/>
        </property>
    </bean>
</beans

>