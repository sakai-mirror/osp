<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping
    PUBLIC "-//Hibernate/Hibernate Mapping DTD//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="org.theospi.portfolio.reports.model" default-lazy="false" >
<!-- 
    <class
        name="ReportDefinition"
        table="osp_reports_definitions" lazy="true">
        
        <id name="reportDefId" length="36"
            type="org.sakaiproject.metaobj.shared.IdType" column="reportDefId">
            <generator class="org.sakaiproject.metaobj.shared.IdGenerator" />
        </id>
        
        <property name="title" type="java.lang.String" />
        <property name="query" type="java.lang.String" />
        <property name="keywords" type="java.lang.String" />
        <property name="description" type="java.lang.String" />
        <property name="defaultXsl" type="java.lang.String" />
        <property name="exportXsl" type="java.lang.String" />
        
        <list name="reportDefinitionParams" cascade="all-delete-orphan" inverse="true"
            lazy="true">
            <key column="reportDefParamId" />
            <index column="seq_num" />
            <one-to-many class="ReportDefinitionParam" />
        </list>
        <set name="xsls" cascade="all-delete-orphan" inverse="true"
            lazy="true">
            <key column="reportXslId" />
            <one-to-many class="ReportXsl" />
        </set>
    </class>
    
    
    <class
        name="ReportDefinitionParam"
        table="osp_reports_definition_params" lazy="true">
        
        <id name="reportDefParamId" length="36"
            type="org.sakaiproject.metaobj.shared.IdType" column="reportDefParamId">
            <generator class="org.sakaiproject.metaobj.shared.IdGenerator" />
        </id>
        <!- - 
        <many-to-one name="reportDefinition" column="reportDefId"
            class="ReportDefinition" cascade="delete" />
        - - >
            
        <property name="title" type="java.lang.String" />
        <property name="paramName" type="java.lang.String" />
        <property name="description" type="java.lang.String" />
        <property name="type" type="java.lang.String" /> <!- - data type: boolean, int, float, date, string - - >
        <property name="valueType" type="java.lang.String" /> <!- - fill-in, select one/many from set/sql, static - - >
        <property name="value" type="java.lang.String" /> <!- - sql query, validation rules, set - - >
    </class>
    
    <class
        name="ReportXsl"
        table="osp_reports_xsls" lazy="true">
        
        <id name="reportXslId" length="36"
            type="org.sakaiproject.metaobj.shared.IdType" column="reportXslId">
            <generator class="org.sakaiproject.metaobj.shared.IdGenerator" />
        </id>
        
          <many-to-one name="reportDefinition" column="reportDefId"
            class="ReportDefinition" cascade="delete" />
            
        <property name="xslLink" type="java.lang.String" />
        <property name="isExport" type="boolean" />
        <property name="title" type="java.lang.String" />
        <property name="contentType" type="java.lang.String" />
        <property name="extension" type="java.lang.String" />
    </class>
    -->
    <class name="ReportDefinitionXmlFile"
           table="osp_report_def_xml" >

        <id name="reportDefId" length="36" type="java.lang.String" column="reportDefId"/>
        <property name="xmlFile" column="xmlFile" type="binary" not-null="true" length="2147483647"/>
        <set name="reportXslFiles" cascade="all" inverse="true">
            <key column="reportDefId" />
            <one-to-many class="ReportXslFile" />
        </set>

    </class>
     <class name="ReportXslFile"
           table="osp_report_xsl">
         <id name="reportXslFileId" length="36"
            type="org.sakaiproject.metaobj.shared.IdType" column="reportXslFileId">
            <generator class="org.sakaiproject.metaobj.shared.IdGenerator" />
        </id>
         <property name="reportXslFileRef" length="255" type="java.lang.String" column="reportXslFileRef"/>
         <many-to-one name="reportDef" column="reportDefId"
            class="ReportDefinitionXmlFile" cascade="delete" />
         <property name="xslFile" column="xslFile" type="binary" not-null="true" length="2147483647"/>
    </class>
    <class
        name="Report"
        table="osp_reports">
        
        <id name="reportId" length="36"
            type="org.sakaiproject.metaobj.shared.IdType" column="reportId">
            <generator class="org.sakaiproject.metaobj.shared.IdGenerator" />
        </id>
        
        <!--  <many-to-one name="reportDefinition" column="reportDefId"
            class="ReportDefinition" cascade="delete" /> -->
        <property name="reportDefIdMark" type="java.lang.String" />
            
        <property name="userId" type="java.lang.String" />
        <property name="title" type="java.lang.String" />
        <property name="keywords" type="java.lang.String" />
        <property name="description" type="java.lang.String" />
        <property name="isLive" type="boolean" />
        <property name="creationDate" type="java.util.Date" />
        <property name="type" type="java.lang.String" />
        <property name="display" type="boolean" />
        
        <list name="reportParams" cascade="all" inverse="true">
            <key column="reportId" />
            <index column="reportDefParamIdMark" />
            <one-to-many class="ReportParam" />
        </list>
    </class>
    
    <class
        name="ReportParam"
        table="osp_reports_params">
        
        <id name="paramId" length="36"
            type="org.sakaiproject.metaobj.shared.IdType" column="paramId">
            <generator class="org.sakaiproject.metaobj.shared.IdGenerator" />
        </id>
        
        <many-to-one name="report" column="reportId"
            class="Report" cascade="delete" />
            
        <!--  <many-to-one name="reportDefinitionParam" column="reportDefParamId"
            class="ReportDefinitionParam" cascade="delete" /> -->
        <property name="reportDefParamIdMark" type="java.lang.String" />

        <property name="value" type="java.lang.String" /> 
    </class>
    
    <class
        name="ReportResult"
        table="osp_reports_results">
        
        <id name="resultId" length="36"
            type="org.sakaiproject.metaobj.shared.IdType" column="resultId">
            <generator class="org.sakaiproject.metaobj.shared.IdGenerator" />
        </id>
        
        <many-to-one name="report" column="reportId"
            class="Report" cascade="none" />

        <property name="userId" type="java.lang.String" />
        <property name="title" type="java.lang.String" />
        <property name="keywords" type="java.lang.String" />
        <property name="description" type="java.lang.String" />
        <property name="creationDate" type="java.util.Date" />
        <property name="xml" type="text" length="16777215" />
    </class>
    
    <query name="findResultsByUser">
		from ReportResult r WHERE r.userId=?
   </query>
    <query name="findResultsById">
		from ReportResult r WHERE r.resultId=?
   </query>
    <query name="findReportsByUser">
		from Report r WHERE r.userId=? AND r.isLive=1 AND r.display=1
   </query>
    
    <query name="findResultsByReport">
		from ReportResult rr WHERE rr.report=?
   </query>
   <query name="findReportById">
		from Report r WHERE reportId=?
   </query>
    <query name="findReportDefinitionFiles">
		from ReportDefinitionXmlFile
   </query>
    <query name="findReportDefinitionFileById">
		from ReportDefinitionXmlFile r WHERE r.reportDefId =?
   </query>
    
</hibernate-mapping>
