<?xml version="1.0" encoding="UTF-8"?>

<project xmlns:j="jelly:core"
	xmlns:ant="jelly:ant">

   <goal name="osp_ddl">
<!--       <j:set var="maven.hibernate.properties" value="/java/apache-tomcat-5.5.16/sakai/sakai.properties" /> -->
      <j:set var="maven.hibernate.properties" value="ddl.properties" />
      <j:set var="maven.hibernate.text" value="true" />
      <j:set var="maven.hibernate.delimiter" value=";" />
      <j:set var="maven.hibernate.input.dir" value="common,glossary,integration,jsf,matrix,migration,portal,presentation,reports,warehouse,wizard" />
      <j:set var="maven.hibernate.input.includes" value="**/target/**/*.hbm.xml" />
      
      <j:set var="schemaexport.noDatabaseOverwrite" value="yes"/>

      <attainGoal name="hibernate:schema-export" />
   </goal>
   
	<goal name="osp-schema">
		<!-- Skip the tests -->
		<j:set var="maven.test.skip" value="true" />

		<!-- Run the non-db tests first, so all of the test classes and mappings are available in ${maven.build.dest} -->
	 <!-- 
	 <attainGoal name="test:test" />
	  -->
		<j:set var="maven.hibernate.properties" value="ddl.properties" />
		<j:set var="hibernate.hbm2ddl.auto" value="create" />
		<j:set var="maven.hibernate.delimiter" value=";" />
		<j:set var="maven.hibernate.quiet" value="false" />
		<j:set var="maven.hibernate.input.dir" value="common,glossary,integration,jsf,matrix,migration,portal,presentation,reports,warehouse,wizard" />
		<j:set var="maven.hibernate.input.includes" value="**/target/**/*.hbm.xml" />
		
		<j:set var="schemaexport.noDatabaseOverwrite" value="yes"/>

		<!-- The Maven plug-in for Hibernate 3 is not yet available to support this goal. -->
		<!--
		<attainGoal name="hibernate:schema-export" />
		-->
		
		 <echo message="Basedir ${basedir}"/>
		 
		<ant:path id="schemaexport.classpath">
			<ant:path refid="maven.dependency.classpath" />
			<ant:pathelement location="${basedir}/**/target/classes" />
		</ant:path>
		<ant:taskdef name="schemaexport" classname="org.hibernate.tool.hbm2ddl.SchemaExportTask" classpathref="schemaexport.classpath" />
		<ant:schemaexport properties="${maven.hibernate.properties}" delimiter=";" text="${schemaexport.noDatabaseOverwrite}" output="osp.sql">
			<ant:fileset dir="${basedir}">
				<ant:include name="${maven.hibernate.input.includes}"/>
			</ant:fileset>
		</ant:schemaexport>
	</goal>

</project>