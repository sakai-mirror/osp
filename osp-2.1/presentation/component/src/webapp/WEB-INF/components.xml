<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans default-lazy-init="false">

   <bean id="ospPresentationHibernateMappings"
      class="org.sakaiproject.springframework.orm.hibernate.impl.AdditionalHibernateMappingsImpl">
      <property name="mappingResources">
         <list>
            <value>org/theospi/portfolio/presentation/model/impl/PresentationImpl.hbm.xml</value>
         </list>
		</property>
   </bean>

   <bean id="presentationToolPermissionsMap"
      class="org.theospi.portfolio.security.mgt.impl.AddPermissionTool"
      init-method="init" lazy-init="false" singleton="true" >
      <property name="manager">
         <ref bean="org.theospi.portfolio.security.mgt.PermissionManager"/>
      </property>
      <property name="additionalTools">
         <map>
            <entry key="presentationTemplate">
               <ref bean="org.theospi.portfolio.security.mgt.ToolPermissionManager.presentationTemplate"/>
            </entry>
            <entry key="presentation">
               <ref bean="org.theospi.portfolio.security.mgt.ToolPermissionManager.presentation"/>
            </entry>
         </map>
      </property>
   </bean>
   
   <bean id="presentationManager"
      class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
      singleton="true">
      <property name="transactionManager">
        <ref bean="org.sakaiproject.springframework.orm.hibernate.GlobalTransactionManager"/>
      </property>
      <property name="target">
         <ref bean="presentationManagerTarget"/>
      </property>
      <property name="transactionAttributes">
         <props>
            <prop key="*">PROPAGATION_REQUIRED</prop>
         </props>
      </property>
   </bean>

   <bean id="org.sakaiproject.metaobj.shared.ArtifactFinder.fileArtifactPresentation"
      parent="org.sakaiproject.metaobj.shared.ArtifactFinder.fileArtifact"
      class="org.theospi.portfolio.shared.mgt.ContentWrappedArtifactFinder" />

   <bean id="org.sakaiproject.metaobj.shared.ArtifactFinderManager.presentation"
      class="org.theospi.portfolio.shared.mgt.WrappedArtifactFinderManager">
      <property name="base">
         <ref bean="artifactFinderManager"/>
      </property>
      <property name="substitutions">
         <map>
            <entry key="fileArtifact">
               <ref bean="org.sakaiproject.metaobj.shared.ArtifactFinder.fileArtifactPresentation" />
            </entry>
         </map>
      </property>
   </bean>

   <bean id="org.sakaiproject.service.legacy.entity.EntityProducer.ospPresentation"
      class="org.theospi.portfolio.presentation.model.impl.PresentationContentEntityProducer"
      init-method="init" >
      <property name="entityManager">
         <ref bean="org.sakaiproject.service.legacy.entity.EntityManager"/>
      </property>
      <property name="httpAccess">
         <ref bean="org.sakaiproject.service.legacy.entity.HttpAccess.osp" />
      </property>
      <property name="idManager">
         <ref bean="idManager"/>
      </property>
      <property name="presentationManager">
         <ref bean="presentationManager"/> 
      </property>
   </bean>

   <bean id="presentationManagerTarget"
      class="org.theospi.portfolio.presentation.model.impl.PresentationManagerImpl">
      <property name="lockManager">
         <ref bean="org.sakaiproject.component.legacy.content.LockManager"/>
      </property>
      <property name="authnManager"><ref bean="authManager"/></property>
      <property name="sessionFactory">
         <ref bean="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory"/>
      </property>
      <property name="agentManager">
         <ref bean="agentManager"/>
      </property>
      <property name="authzManager">
         <ref bean="authzManager"/>
      </property>
      <property name="idManager">
         <ref bean="idManager"/>
      </property>
      <property name="homeFactory">
         <ref bean="homeFactory"/>
      </property>
      <property name="artifactFinderManager">
         <ref bean="org.sakaiproject.metaobj.shared.ArtifactFinderManager.presentation"/>
      </property>
      <property name="worksiteManager">
         <ref bean="org.sakaiproject.metaobj.worksite.mgt.WorksiteManager"/>
      </property>
      <property name="contentHosting">
         <ref bean="org.sakaiproject.service.legacy.content.ContentHostingService"/>
      </property>
      <property name="securityService">
         <ref bean="org.sakaiproject.service.legacy.security.SecurityService"/>
      </property>
   </bean>

   <bean id="presentationAuthz" class="org.theospi.portfolio.presentation.PresentationAuthorizerImpl">
      <property name="presentationManager"><ref bean="presentationManager"/></property>
      <property name="idManager"><ref bean="idManager"/></property>
      <property name="functions">
         <list>
            <bean id="org.sakaiproject.service.legacy.content.ContentHostingService.EVENT_RESOURCE_READ"
               class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
            </bean>
            <bean id="org.theospi.portfolio.presentation.PresentationFunctionConstants.COMMENT_PRESENTATION"
               class="org.sakaiproject.metaobj.utils.ioc.FieldRetrievingFactoryBean">
               <property name="staticField">
                  <value>org.theospi.portfolio.presentation.PresentationFunctionConstants.COMMENT_PRESENTATION</value>
               </property>
            </bean>
            <bean id="org.theospi.portfolio.presentation.PresentationFunctionConstants.CREATE_TEMPLATE"
               class="org.sakaiproject.metaobj.utils.ioc.FieldRetrievingFactoryBean">
               <property name="staticField">
                  <value>org.theospi.portfolio.presentation.PresentationFunctionConstants.CREATE_TEMPLATE</value>
               </property>
            </bean>
            <bean id="org.theospi.portfolio.presentation.PresentationFunctionConstants.EDIT_TEMPLATE"
               class="org.sakaiproject.metaobj.utils.ioc.FieldRetrievingFactoryBean">
               <property name="staticField">
                  <value>org.theospi.portfolio.presentation.PresentationFunctionConstants.EDIT_TEMPLATE</value>
               </property>
            </bean>
            <bean id="org.theospi.portfolio.presentation.PresentationFunctionConstants.PUBLISH_TEMPLATE"
               class="org.sakaiproject.metaobj.utils.ioc.FieldRetrievingFactoryBean">
               <property name="staticField">
                  <value>org.theospi.portfolio.presentation.PresentationFunctionConstants.PUBLISH_TEMPLATE</value>
               </property>
            </bean>
            <bean id="org.theospi.portfolio.presentation.PresentationFunctionConstants.DELETE_TEMPLATE"
               class="org.sakaiproject.metaobj.utils.ioc.FieldRetrievingFactoryBean">
               <property name="staticField">
                  <value>org.theospi.portfolio.presentation.PresentationFunctionConstants.DELETE_TEMPLATE</value>
               </property>
            </bean>
            <bean id="org.theospi.portfolio.presentation.PresentationFunctionConstants.COPY_TEMPLATE"
               class="org.sakaiproject.metaobj.utils.ioc.FieldRetrievingFactoryBean">
               <property name="staticField">
                  <value>org.theospi.portfolio.presentation.PresentationFunctionConstants.COPY_TEMPLATE</value>
               </property>
            </bean>
            <bean id="org.theospi.portfolio.presentation.PresentationFunctionConstants.EXPORT_TEMPLATE"
               class="org.sakaiproject.metaobj.utils.ioc.FieldRetrievingFactoryBean">
               <property name="staticField">
                  <value>org.theospi.portfolio.presentation.PresentationFunctionConstants.EXPORT_TEMPLATE</value>
               </property>
            </bean>
            <bean id="org.theospi.portfolio.presentation.PresentationFunctionConstants.CREATE_PRESENTATION"
               class="org.sakaiproject.metaobj.utils.ioc.FieldRetrievingFactoryBean">
               <property name="staticField">
                  <value>org.theospi.portfolio.presentation.PresentationFunctionConstants.CREATE_PRESENTATION</value>
               </property>
            </bean>
            <bean id="org.theospi.portfolio.presentation.PresentationFunctionConstants.EDIT_PRESENTATION"
               class="org.sakaiproject.metaobj.utils.ioc.FieldRetrievingFactoryBean">
               <property name="staticField">
                  <value>org.theospi.portfolio.presentation.PresentationFunctionConstants.EDIT_PRESENTATION</value>
               </property>
            </bean>
            <bean id="org.theospi.portfolio.presentation.PresentationFunctionConstants.DELETE_PRESENTATION"
               class="org.sakaiproject.metaobj.utils.ioc.FieldRetrievingFactoryBean">
               <property name="staticField">
                  <value>org.theospi.portfolio.presentation.PresentationFunctionConstants.DELETE_PRESENTATION</value>
               </property>
            </bean>
         </list>
      </property>
   </bean>

   <bean id="org.theospi.portfolio.security.app.AdditionalAppAuthorizers.presentation"
      class="org.theospi.portfolio.security.app.AdditionalAppAuthorizers"
      init-method="init" singleton="true">
      <property name="authzManager"><ref bean="authzManager"/></property>
      <property name="additionalAppAuthorizers">
         <list>
            <bean class="org.theospi.portfolio.security.app.OrderedAuthorizer">
               <property name="order"><value>3</value></property>
               <property name="authorizer"><ref bean="presentationAuthz"/></property>
            </bean>
         </list>
      </property>
   </bean>

   <bean id="org.theospi.portfolio.security.mgt.ToolPermissionManager.presentation"
      class="org.theospi.portfolio.security.model.CleanupPermissionManager"
       singleton="true">

      <property name="idManager"><ref bean="idManager"/></property>
      <property name="service"><ref bean="presentationManager"/></property>
      <property name="authzManager"><ref bean="authzManager"/></property>
      <property name="permissionManager">
         <ref bean="org.theospi.portfolio.security.mgt.PermissionManager" />
      </property>
      <property name="agentManager"><ref bean="agentManager" /></property>
      <property name="permissionEditName"><value>presentation</value></property>
      <property name="defaultPermissions">
         <map>
            <entry key="maintain">
               <list>
                  <value>osp.presentation.create</value>
               </list>
            </entry>
            <entry key="access">
               <list>
                  <value>osp.presentation.create</value>
               </list>
            </entry>
         </map>
      </property>
      <property name="functions">
         <list>
            <value>osp.presentation.delete</value>
            <value>osp.presentation.comment</value>
            <value>osp.presentation.create</value>
         </list>
      </property>
   </bean>

   <bean id="org.theospi.portfolio.security.mgt.ToolPermissionManager.presentationTemplate"
      class="org.theospi.portfolio.security.model.SimpleToolPermissionManager"
       singleton="true">

      <property name="idManager"><ref bean="idManager"/></property>
      <property name="permissionManager">
         <ref bean="org.theospi.portfolio.security.mgt.PermissionManager" />
      </property>
      <property name="agentManager"><ref bean="agentManager" /></property>
      <property name="permissionEditName"><value>presentationTemplate</value></property>
      <property name="defaultPermissions">
         <map>
            <entry key="maintain">
               <list>
                  <value>osp.presentation.template.copy</value>
                  <value>osp.presentation.template.publish</value>
                  <value>osp.presentation.template.delete</value>
                  <value>osp.presentation.template.create</value>
                  <value>osp.presentation.template.edit</value>
                  <value>osp.presentation.template.export</value>
               </list>
            </entry>
            <entry key="access">
               <list>
                  <value>osp.presentation.template.create</value>
                  <value>osp.presentation.template.copy</value>
                  <value>osp.presentation.template.export</value>
               </list>
            </entry>
         </map>
      </property>
      <property name="functions">
         <list>
            <value>osp.presentation.template.copy</value>
            <value>osp.presentation.template.publish</value>
            <value>osp.presentation.template.delete</value>
            <value>osp.presentation.template.create</value>
            <value>osp.presentation.template.edit</value>
            <value>osp.presentation.template.export</value>
         </list>
      </property>
   </bean>

</beans>
